# Антипатерн "интерфейс компактнее реализации"

## Идея
Интерфейс это не только описание названий и сигнатур методов. Это говорит о том, как возможно использовать этот интерфейс и в каких случаях.

В идеале, неправильное использование делается
в принципе не правильным на уровне интерфейса. Но в саму спецификацию мы можем включить советы по тому, какой интерфейс лучше использовать в данном случае, например, когда стоит добавить Autocloseable.
Говоря в терминолоии мейнстрима, интерфейс это не только сам интерфейс в исходном коде, но и его описание в конфлюенсе.

_Интересный факт:_ для 3 комманд POSIX потребовалось более 300 страниц спецификации.

## Примеры 

### Ghost State/Призрачное состояние.
1. "Детский пример". 
В обработчике сигнала, при обработке сигнала_1 в поле_А обработчика, записалось значение ид сигнала_1,
и началась обработка. В середине этой обработки пришел сигнал_2, и в поле_А уже записался ид сигнала_2,
в то время, как все еще выполнялись действия для сигнала_1. В результате когда отправляем результат обработки сигнала_1, он уходит по ид сигнала_2, из-за чего полная путаница. 

Исправляется это убиранием общего состояния из поля в аргументы метода, которые уникальны для каждого его вызова.

2. До: В системе 1 для сущности_X есть состояния A,B,C, и как алиас D.
В Системе 2, для той же сущности_Х Есть состояния D,B,C. 
Причем при обмене информацией между системами, в системе 1, состояние D, 
во всех местах отображается в состояние А. Это размазывает эти проверки по коду. 

После: В системе 1 оставили только состояния A,B,C, а D из перечисленных убрали. 
Теперь сразу при получении и передаче информации из системы 2, состояние D преобразуется в A. 
Где требуется показать, что было получено состояние D, это выводится в лог перед преобразованием в A.


### Неточности в описании интерфейса, ведущие к его чрезмерному сужению
1. Платформозависимые ограничения,
вроде того, что IE для ПК поддерживает Activex для записи на диск, a ero CompactEdition - нет. При том, что сама настройка включения/отключения использования ActiveX в CE версии есть и почему не работает ActiveX касающиеся конкретно этой функциональности - непонятно.

2. С чрезмерно узкими определения проще вспомнить примеры, требований под некоторые юридические определения, когда это требует долгого изменения и когда условие оказалось излишне твердым. 
О подобных примерах недавно прочитал книгу "Взломать все" американского криптографа, писателя и специалиста по компьютерной безопасности Брюса Шнайера.
Пример: Для признания малоимущим есть критерий, что должно быть не более 1 машины на семью, но не учитываются стоимости этих машин. Если юридически все еще записана машина, которая фактически своих свойств не выполняет, и еще одна полуживая, то это повод,
не признавать малоимущими, в то время как наличие 1 новой и дорогой машины, никак этим критерием не останавливается.

3. До: передача в метод обновления объекта одного поля, которое мы хотим обновить, и созданию большой группы таких методов.
После: Метод обновления 1 и принимает в качестве аргумента DTO в котором переданы значения, которые должна теперь принять сущность.

### Когда интерфейс не должен быть компактнее реализации

1. Сам интерфейс веб-хуки от GitLab был тривиален и удобен, но в более полной спецификации оговаривалась возможность того, что на одне событие GitLab может отправлять несколько одинаковых веб-хуков и это должен обрабатывать клиент.
В одной из версий API достаточно было просто отправлять от клиента веб-хуки, ответ серверу как можно быстрее, что бы не было повтора, но в будущих версиях
и это перестало помогать. Это так же пример и Ghost state.

2. В общем случае, когда интерфейс описывает чего нельзя делать в реализации.
В этом случае чем сильнее зададим ограничения для написания правильных программ,
тем лучше будет результат, вплоть до того,
что неправильные программы даже не скомпилируются.
Но делать это с учетом математический доказательств,
того что выразить, например, на данном языке программирования можно достаточно понятий, иначе придем проблеме с неточностью интерфейса с его чрезмерным сужением.
